@model dynamic

@*<div class="row">
    <div class="col-md-offset-10">*@
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalWindow">Добавить игрока</button>
@*</div>
    </div>*@
<table class="table table-hover">
    <thead>
        <tr>
            <th>
                Номер игрока
            </th>
            <th>
                ФИО
            </th>
            <th>
                Национальность
            </th>
            <th>
                Возраст
            </th>
            <th>
                Рост (см.)
            </th>
            <th>
                Вес (кг.)
            </th>
            <th>
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var pl in ViewBag.Players)
        {
            <tr>
                <td>
                    @pl.PlayerNumber
                </td>
                <td>
                    @pl.MiddleName @pl.FirstName @pl.LastName
                </td>
                <td>
                    @pl.Nationality
                </td>

                @if (@pl.Age != null)
                {
                    <td>
                        @pl.Age
                    </td>
                }
                else
                {
                    <td>
                        Неизвестно
                    </td>
                }
                @if (@pl.Height != null)
                {
                    <td>
                        @pl.Height
                    </td>
                }
                else
                {
                    <td>
                        Неизвестно
                    </td>
                }
                @if (@pl.Weight != null)
                {
                    <td>
                        @pl.Weight
                    </td>
                }
                else
                {
                    <td>
                        Неизвестно
                    </td>
                }
                <td>
                    <div class="btn-group">
                        <button id="Edit" class="btn btn-default btn-xs" value="@pl.ManID" name="ManID">Профиль</button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary btn-xs dropdown-toggle" data-toggle="dropdown">
                                Действия <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#" id="Delete" value="@pl.ManID" name="ManID">Редактировать</a></li>
                                <li>
                                    <a href="#RemovePlayer" id="Delete" class="label-danger">Удалить</a>
                                    <form id="RemovePlayer" action="/Players/RemovePlayerActionResult" method="post" value="@pl.ManID" name="ManID"></form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>


<div class="modal fade" id="ModalWindow" role="dialog" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    х
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Добавление игрока
                </h4>
            </div>
            <form role="form" class="form-group" action="/Players/AddPlayerActionResult" method="post">
                <div class="modal-body" id="AddPlayerModal">
                    <div class="form-group has-feedback">
                        <label class="control-label" for="PlayerName">Полное имя</label>
                        <input name="PlayerName" class="form-control input-required" placeholder="Фамилия Имя Отчество" aria-describedby="inputError2Status">
                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                        <span id="inputError2Status" class="sr-only">(error)</span>
                    </div>
                    <div class="form-group has-feedback">
                        <label class="control-label">Рост</label>
                        <input type="number" min="50" max="250" name="Height" class="form-control input-required" placeholder="Рост игрока" />
                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                        <span id="inputError2Status" class="sr-only">(error)</span>
                    </div>
                    <div class="form-group has-feedback">
                        <label class="control-label">Вес</label>
                        <input type="number" min="30" max="150" name="Weight" class="form-control input-required" placeholder="Вес игрока" />
                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                        <span id="inputError2Status" class="sr-only">(error)</span>
                    </div>
                    <div class="form-group has-feedback">
                        <label class="control-label">Номер</label>
                        <input type="number" min="1" max="99" name="PlayerNumber" class="form-control input-required" placeholder="Номер" />
                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                        <span id="inputError2Status" class="sr-only">(error)</span>
                    </div>
                    <div>
                        <label class="control-label">День рождения</label>
                        <input type="date" name="Birthday" class="form-control" value="1999-01-01" min='1917-01-01' />

                    </div>
                    <div>
                        <label class="control-label">Национальность</label>
                        <select name="Nationality" class="form-control">
                            @foreach (var nat in ViewBag.Nationalities)
                            {
                                <option value=@nat.NationalityID>@nat.Nationality</option>
                            }
                        </select>
                    </div>
                    <div>
                        <label class="control-label">Дата заключения контракта</label>
                        <input type="date" id="ContractStart" name="ContractStart" class="form-control" min='1899-01-01' />

                    </div>
                    <div>
                        <label class="control-label">Дата окончания контракта</label>
                        <input type="date" id="ContractEnd" name="ContractEnd" class="form-control" min='1899-01-01' />
                    </div>
                    <div>
                        <label class="control-label">Зарплата</label>
                        <input type="number" value="5000" min="1" name="ContractMoney" class="form-control" placeholder="Зарплата в неделю" />
                    </div>
                    <div>
                        <label class="control-label">Трансферная стоимость</label>
                        <input type="number" value="50000" min="1" name="TransferPrice" class="form-control" placeholder="Стоимость на трансферном рынке" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        Отмена
                    </button>
                    <button type="submit" class="btn btn-primary" id="AddPlayerButton">
                        Добавить
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $(document).ready(function () {
        $(".input-required").on("focusout",
        function () {
            if (this.value === "") {

                $(this).parent().addClass("has-error")
                $(this).next().addClass("glyphicon-remove")
            }
            else {
                $(this).parent().removeClass("has-error")
                $(this).next().removeClass("glyphicon-remove")
            }
        })
        $("input[name='Height'], input[name='Weight'],  input[name='PlayerNumber']").on("focusout", function () {
            if (this.value === "") {

            }
            else
                if (this.value > parseInt($(this).attr("max"))) {
                    this.value = parseInt($(this).attr("max"));
                }
                else
                    if (this.value < parseInt($(this).attr("min"))) {
                        this.value = parseInt($(this).attr("min"));
                    }
        })
        var now = new Date();
        var month = (now.getMonth() + 1);
        var day = now.getDate();
        if (month < 10)
            month = "0" + month;
        if (day < 10)
            day = "0" + day;
        var today = now.getFullYear() + '-' + month + '-' + day;
        $('#ContractStart').val(today);
        $('#ContractEnd').val(today);

        $('#ModalWindow').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
        })
    })
</script>
